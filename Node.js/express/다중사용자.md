# lowdb 사용
- ```npm install -s lowdb```	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;```lowdb```설치
- ```javascript
  var low = require('lowdb');	//모듈 불러오기
  var FileSync = require('lowdb/adapters/FileSync');	//동기방법으로 lowdb의 데이터를 파일에 저장
  var adapter = new FileSync('db.json');		//db.json파일에 동기 방법으로 데이터를 저장
  var db = low(adapter);	//동기방법으로 데이터를 db.json파일에 저장하여 lowdb를 제어 
  db.defaults({users:[]}).write();	//lowdb를 통해서 데이터를 저장할때 users에 저장(초기화) write =lowdb동작
  ```

### 식별자 부여
- 회원정보에 고유한 식별자를 부여하기 위해 ```lowdb```의 ```shortid``` 사용
- ```npm install -s shortid```	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;```shortid``` 설치
- ```var shortid =require('shortid');```	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;```shortid``` 모듈 불러오기
##### router/auth.js
- ```javascript
  router.post('/register_process', function (request, response) {

        var post = request.body;	//전송된 데이터 입력
        var email = post.email;
        var pwd = post.pwd;
        var pwd2 = post.pwd2;
        var displayName = post.displayName;
        if(pwd !== pwd2){	  // 두번 입력된 password 가 틀리면
          request.flash('error', 'Password must same');	  //flash message 출력
          response.redirect('/auth/register');	  //'/auth/register'로 주소이동
        } else {
       var user ={
    id:shortid.generate(),	//랜덤한 고유한 식별자 생성    
          email:email,			//전송받은 데이터를 db.json에 추가
          password:pwd,
          displayName:displayName
        }) ;
          db.get('users').push(user).write();		//users에 push로 데이터추가
          request.login(user, function(err){  	// register가 된후 자동으로 login
            return   response.redirect('/');		// '/'로 주소이동
          })
        }
   });
   ```
### 로그인 구현
##### passport.js
- ```javascript
    passport.use(new LocalStrategy({
            usernameField: 'email',	//기본값을 email로 변경
            passwordField: 'pwd'	//기본값을 pwd로 변경
        },
        function (email, password, done) {
            console.log('localstrategy', email, password);
            var user = db.get('users').find({email:email, password:password}).value(); //users의 email이 전송받은 email데이터,password가 전송받은 password와 일치하는 데이터가존재하면 데이터 저장
            if(user){ 	//user의 데이터가 있다면 true
                return done(null, user, {		//user가 존재하기때문에 로그인 성공
                    message: 'Welcome.'
                });
            } else{
                return done(null, false, {
                    message: 'Incorrect user information.'
                });
            }

        }
    ));
    ```
